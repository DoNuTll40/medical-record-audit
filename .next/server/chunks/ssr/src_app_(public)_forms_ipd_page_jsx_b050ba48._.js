module.exports=[33050,a=>a.a(async(b,c)=>{try{a.s(["default",()=>A]);var d=a.i(87924),e=a.i(72131),f=a.i(10237),g=a.i(63706),h=a.i(76343),i=a.i(75090),j=a.i(74308),k=a.i(13902),l=a.i(86269),m=a.i(13490),n=a.i(18213),o=a.i(46271),p=a.i(24738),q=a.i(69369),r=a.i(98347),s=a.i(8433),t=a.i(20267),u=a.i(18344),v=a.i(91392),w=a.i(37610),x=a.i(43670),y=a.i(42829),z=b([s,t]);function A(){let{profile:a,authLoading:b}=(0,g.default)(),{setAutoSaveMessage:c}=(0,y.default)(),{resolvedTheme:z}=(0,k.useTheme)(),[A,B]=(0,e.useState)(localStorage.getItem("token")),[C,D]=(0,e.useState)(!1),[E,F]=(0,e.useState)(""),[G,H]=(0,e.useState)({hcode:"",hcode_name:""}),[I,J]=(0,e.useState)([]),[K,L]=(0,e.useState)([]),[M,N]=(0,e.useState)(null),[O,P]=(0,e.useState)(""),[Q,R]=(0,e.useState)(!1),[S,T]=(0,e.useState)(!1),[U,V]=(0,e.useState)(!1),[W,X]=(0,e.useState)({content:[],overall:[],review_status_id:null,review_status_result:null,review_status_comment:""}),[Y,Z]=(0,e.useState)(null),[$,_]=(0,e.useState)(!1),[aa,ab]=(0,e.useState)(!1),[ac,ad]=(0,e.useState)(!1),[ae,af]=(0,e.useState)(null),ag=(0,e.useRef)(),ah=(0,e.useRef)(null),ai=new m.default;if((0,e.useEffect)(()=>D(!0),[]),(0,e.useEffect)(()=>{try{B(localStorage.getItem("token"))}catch{}},[]),!A)return(0,d.jsx)(x.default,{});if(null===A)return(0,d.jsx)(f.default,{});let aj=(0,e.useCallback)(a=>{a.api.sizeColumnsToFit()},[]),ak=async()=>{let a=localStorage.getItem("token");try{let b=await h.default.get("/setting/hcode",{headers:{Authorization:`Bearer ${a}`}});200===b.status&&H(b.data.data[0])}catch(a){console.log(a)}},al=async a=>{ad(!1);try{let b=await h.default.get(`mraIpd/fetchPatient/${a}`,{headers:{Authorization:`Bearer ${A}`}});200===b.status&&(Z(b.data.data),await am(a),(0,u.addToast)({title:"สําเร็จ",description:b.data.message,timeout:8e3,color:"success",shouldShowTimeoutProgress:!0}))}catch(b){if(console.log(b),b?.response?.status===409)return void await am(a);(0,u.addToast)({title:"เกิดข้อผิดพลาด",description:b.response.data.message,timeout:8e3,color:"danger",shouldShowTimeoutProgress:!0})}};(0,l.useIdleTimer)({timeout:1e3,onIdle:()=>{E?.trim()&&al(E)},events:["keyup"],element:ah.current,immediateEvents:[]});let am=async a=>{T(!0);try{let b=await h.default.post("/mraIpd",{patient_an:a},{headers:{Authorization:`Bearer ${A}`}});if(200===b.status){(0,u.addToast)({title:"สําเร็จ",description:b.data.message,timeout:8e3,color:"success",shouldShowTimeoutProgress:!0});let a=b.data.data;J(a[0].form_ipd_content_of_medical_record_results),L(a[0].form_ipd_overall_finding_results),an();let c=(Array.isArray(a)?a[0]?.patients:a?.patients)||{};Z({an:c.patient_an||"",hn:c.patient_hn||"",fullname:c.patient_fullname||"",regdate:c.patient_date_admitted||"",dcgdate:c.patient_date_discharged||"",ward_name:c.patient_ward||""}),X(b=>({...b,content:a[0].form_ipd_content_of_medical_record_results.map(a=>{let{created_at:b,updated_at:c,created_by:d,updated_by:e,total_score:f,content_of_medical_records:g,...h}=a,i={content_of_medical_record_id:g?.content_of_medical_record_id};for(let a in h){let b=h[a];"comment"===a?i[a]=b??null:"na"===a||"missing"===a||"no"===a?i[a]=!!b:i[a]="boolean"==typeof b?+!!b:null==b?0:b}return i})}))}}catch(a){console.log(a),409===a.response.status?ao():(0,u.addToast)({title:"เกิดข้อผิดพลาด",description:a.response.data.message,timeout:8e3,color:"danger",shouldShowTimeoutProgress:!0})}finally{T(!1)}};(0,e.useEffect)(()=>{ak(),ah.current.focus()},[b,A,a]);let an=async()=>{try{let a=await h.default.get("/mraIpd/rvst",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});200===a.status&&N(a.data.data)}catch(a){console.log(a)}},ao=async()=>{ab(!0);try{let a=await h.default.get(`/mraIpd/${E}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),b=a.data.data[0];if(200===a.status){ad(!0),af(b);let a=(Array.isArray(b)?b[0]?.patients:b?.patients)||{};Z({an:a.patient_an||"",hn:a.patient_hn||"",fullname:a.patient_fullname||"",regdate:a.patient_date_admitted||"",dcgdate:a.patient_date_discharged||"",ward_name:a.patient_ward||""}),setTimeout(()=>{ag.current&&ag.current.focus()},500)}}catch(a){if(409===a.response.status){ad(!0),P(a.response?.data.data?.pdf_ipd_file);let b=a.response.data.data?.form_ipds?.patients;Z({hn:b.patient_hn||"",fullname:b.patient_fullname||"",regdate:b.patient_date_admitted||"",dcgdate:b.patient_date_discharged||"",ward_name:b.patient_ward||""})}else(0,u.addToast)({title:"เกิดข้อผิดพลาด",description:a.response.data.message,timeout:8e3,color:"danger",shouldShowTimeoutProgress:!0})}finally{ab(!1)}},ap=(a,b)=>"na"===b?a?.missing||a?.no:"missing"===b?a?.na||a?.no:"no"===b?a?.na||a?.missing:a?.na||a?.missing||a?.no,aq=[{field:"content_of_medical_record_name",pinned:"left",headerName:"หัวข้อเวชระเบียน",valueGetter:a=>{let b=a.node.rowIndex+1,c=a.data.content_of_medical_records?.content_of_medical_record_name||"";return`${b}.${c}`},minWidth:240},{field:"na",editable:a=>!ap(a.data,"na")&&a.data.content_of_medical_records?.na_type!==!1,headerName:"NA",minWidth:60,cellRenderer:"agCheckboxCellRenderer",cellEditor:"agCheckboxCellEditor",cellStyle:a=>ap(a.data,"na")||a.data.content_of_medical_records?.na_type===!1?{backgroundColor:C&&"dark"===z?"#303030":"#D7D7D7",cursor:"not-allowed",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"}:{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"}},{field:"missing",headerName:"Missing",minWidth:80,cellRenderer:"agCheckboxCellRenderer",cellEditor:"agCheckboxCellEditor",editable:a=>!ap(a.data,"missing")&&a.data.content_of_medical_records?.missing_type!==!1,cellStyle:a=>ap(a.data,"missing")||a.data.content_of_medical_records?.missing_type===!1?{backgroundColor:C&&"dark"===z?"#303030":"#D7D7D7",cursor:"not-allowed",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"}:{display:"flex",alignItems:"center",justifyContent:"center"}},{field:"no",headerName:"No",minWidth:60,cellRenderer:"agCheckboxCellRenderer",cellEditor:"agCheckboxCellEditor",cellDataType:"boolean",editable:a=>!ap(a.data,"no")&&a.data.content_of_medical_records?.no_type!==!1,cellStyle:a=>ap(a.data,"no")||a.data.content_of_medical_records?.no_type===!1?{backgroundColor:C&&"dark"===z?"#303030":"#D7D7D7",cursor:"not-allowed",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"}:{display:"flex",alignItems:"center",justifyContent:"center"}},...Array.from({length:9},(a,b)=>{let c=`criterion_number_${b+1}`,d=`${c}_type`;return{field:c,headerName:`เกณฑ์ ${b+1}`,minWidth:80,cellRenderer:"agCheckboxCellRenderer",cellEditor:"agCheckboxCellEditor",cellDataType:"boolean",suppressClickEdit:!0,stopEditingWhenCellsLoseFocus:!0,editable:a=>{let b=ap?.(a.data,c),e=a.data?.content_of_medical_records?.[d]===!1;return!b&&!e},onCellClicked:a=>{let b=ap?.(a.data,c),e=a.data?.content_of_medical_records?.[d]===!1;if(b||e)return;let f=!a.value;a.node.setDataValue(c,f)},cellStyle:a=>{let b=ap?.(a.data,c),e=a.data?.content_of_medical_records?.[d]===!1;return b||e?{backgroundColor:C&&"dark"===z?"#303030":"#D7D7D7",cursor:"not-allowed",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"}:{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"}},valueGetter:a=>{let b=a.data?.[c];return 1===b},valueSetter:a=>(a.data[c]=+!!a.newValue,!0)}}),{field:"point_deducted",headerName:"หักคะแนน",minWidth:90,cellRenderer:"agCheckboxCellRenderer",cellEditor:"agCheckboxCellEditor",cellDataType:"boolean",suppressClickEdit:!0,stopEditingWhenCellsLoseFocus:!0,valueGetter:a=>a.data?.point_deducted===1||a.data?.point_deducted===!0,valueSetter:a=>(a.data.point_deducted=+!!a.newValue,!0),editable:a=>!ap(a.data,"point_deducted")&&a.data.content_of_medical_records?.points_deducted_type!==!1,onCellClicked:a=>{ap(a.data,"point_deducted")||a.data.content_of_medical_records?.points_deducted_type===!1||a.node.setDataValue("point_deducted",!a.value)},cellStyle:a=>ap(a.data,"point_deducted")||a.data.content_of_medical_records?.points_deducted_type===!1?{backgroundColor:C&&"dark"===z?"#303030":"#D7D7D7",cursor:"not-allowed",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"}:{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"}},{field:"comment",headerName:"หมายเหตุ",cellEditor:"agTextCellEditor",editable:!0,minWidth:220,stopEditingWhenCellsLoseFocus:!0,onCellClicked:a=>a.api.startEditingCell({rowIndex:a.rowIndex,colKey:"comment"})}],ar=async()=>{V(!0);let a=localStorage.getItem("token");try{let b=await h.default.put(`/mraIpd/${E}`,W,{headers:{Authorization:`Bearer ${a}`}});200===b.status&&(console.log(b.data),al(E))}catch(a){console.log(a)}finally{V(!1)}},as=async()=>{c({type:"info",message:"กําลังบันทึกอัตโนมัติ..."});let a=localStorage.getItem("token");try{let b=await h.default.put(`/mraIpd/${E}`,W,{headers:{Authorization:`Bearer ${a}`}});200===b.status&&c({type:"success",message:"บันทึกอัตโนมัติสําเร็จ"})}catch(a){console.log(a),c({type:"danger",message:"บันทึกอัตโนมัติไม่สําเร็จ"})}finally{setTimeout(()=>{c("")},5e3)}};(0,l.useIdleTimer)({timeout:2e3,onIdle:Y&&!ac&&null===W.review_status_id?as:null,events:["keydown","keyup","input","change","click"],element:"undefined"!=typeof document?document:null,immediateEvents:[],startOnMount:!1,debounce:500});let at=()=>{X(a=>({...a,content:[],overall:[],review_status_id:null,review_status_result:null,review_status_comment:""}))},au=async a=>{let b=await (0,t.pdf)((0,d.jsx)(s.default,{...a})).toBlob();return await aw(b)};(0,e.useEffect)(()=>{ae&&(async()=>{let a=await au(ae);P(a),av(a,ae.form_ipd_id)})()},[ae]);let av=async(a,b)=>{let c={form_ipd_id:b,binary:a,total_score:ae.totalDefaultSum,score_obtained:ae.totalScoreSum,percentage:ae.formattedResultSum};try{let a=await h.default.post("/mraIpd/insertPdf",c,{headers:{Authorization:`Bearer ${A}`}});200===a.status&&console.log(a.data)}catch(a){console.log(a)}},aw=a=>new Promise((b,c)=>{let d=new FileReader;d.onloadend=()=>b(d.result.split(",")[1]),d.onerror=c,d.readAsDataURL(a)}),ax=async a=>{if(R(!0),a.patient_an!==E)return(0,u.addToast)({title:"เกิดข้อผิดพลาด",description:"หมายเลข AN ไม่ถูกต้อง",timeout:8e3,color:"danger",shouldShowTimeoutProgress:!0});let b={password:a.password};try{let c=await h.default.delete(`/mraIpd/${a.patient_an}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},data:b});200===c.status&&((0,u.addToast)({title:"สําเร็จ",description:c.data.message,timeout:8e3,color:"success",shouldShowTimeoutProgress:!0}),at(),F(""),Z(null),af({}),ad(!1),J([]),_(!1))}catch(a){console.log(a),(0,u.addToast)({title:"เกิดข้อผิดพลาด",description:a.response.data.message,timeout:8e3,color:"danger",shouldShowTimeoutProgress:!0})}finally{R(!1)}};return(0,d.jsxs)(d.Fragment,{children:[(Q||U)&&(0,d.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center dark:bg-black/80 bg-white/40 backdrop-blur-sm",children:(0,d.jsx)(f.default,{title:Q?"กําลังลบข้อมูล...":"กําลังบันทึกข้อมูล..."})}),(0,d.jsx)(v.default,{isOpen:$,onClose:()=>_(!1),delModal:!0,title:`คุณต้องการลบข้อมูล ${(0,w.default)(E,{keepStart:2,keepEnd:2})}`,onSubmit:ax,fields:[{type:"text",name:"patient_an",label:"กรอกหมายเลข AN",placeholder:"XXXXXXXXX",required:!0,radius:"sm"},{type:"password",name:"password",label:"กรอกรหัสผ่าน",placeholder:"**********",required:!0,radius:"sm"}]}),(0,d.jsxs)("div",{className:"select-none rounded-2xl border border-zinc-300 dark:border-[#505050] mb-4 bg-white dark:bg-[#181818] shadow-lg",children:[(0,d.jsxs)("div",{className:"flex justify-between border-b border-zinc-300 dark:border-[#505050] p-4",children:[(0,d.jsxs)("div",{className:"flex gap-1 flex-col",children:[(0,d.jsx)("p",{className:"font-medium",children:"แบบตรวจประเมินคุณภาพการบันทึกเวชระเบียนผู้ป่วยใน Medical Record Audit Form (IPD)"}),(0,d.jsxs)("p",{className:"text-xs font-medium text-zinc-600 dark:text-zinc-500",children:[(0,d.jsx)("span",{className:"font-semibold mr-1",children:"เงื่อนไขการบันทึกเวชระเบียน"}),"การบันทึกคะแนน (1) กรณีที่ผ่านเกณฑ์ในแต่ละข้อ ให้ติ๊กถูก (2) กรณีที่ไม่ผ่านเกณฑ์ในแต่ละข้อ ไม่ต้องติ๊ก (3) กรณีไม่จำเป็นต้องมีบันทึก/ไม่มีข้อมูล ในเกณฑ์ข้อที่ระบุให้มี NA ได้ ให้ NA"]})]}),Y?.ward_name&&(0,d.jsx)("span",{className:"shrink-0 h-fit rounded-full border border-zinc-300 dark:border-zinc-700 px-3 py-1 text-xs text-zinc-700 dark:text-zinc-200 bg-zinc-50 dark:bg-zinc-900/60",children:Y.ward_name})]}),(0,d.jsxs)("div",{className:"p-4 flex flex-col gap-2",children:[(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(i.Input,{variant:"bordered",radius:"md",label:"รหัสสถานพยาบาล",size:"md",placeholder:"XXXXX",value:G?G.hcode:"",labelPlacement:"outside-top",isReadOnly:!0}),(0,d.jsx)(i.Input,{variant:"bordered",radius:"md",label:"ชื่อสถานพยาบาล",size:"md",placeholder:"โรงพยาบาล.....",value:G?G.hcode_name:"",labelPlacement:"outside-top",isReadOnly:!0})]}),(0,d.jsx)(i.Input,{variant:"bordered",radius:"md",label:"ชื่อ-สกุล",size:"md",placeholder:"ชื่อ-สกุล",value:Y?Y.fullname:"",labelPlacement:"outside-top",isDisabled:!0}),(0,d.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 xl:grid-cols-5 gap-2",children:[(0,d.jsx)(i.Input,{ref:ah,value:E,onChange:a=>{F(a.target.value),Z(null),J([]),L([]),ad(!1),af(null),at(),P("")},variant:"bordered",radius:"md",label:"AN",size:"md",placeholder:"AN",labelPlacement:"outside-top",maxLength:9}),(0,d.jsx)(i.Input,{variant:"bordered",radius:"md",label:"HN",size:"md",placeholder:"HN",value:Y?Y.hn:"",labelPlacement:"outside-top",isDisabled:!0}),(0,d.jsx)(i.Input,{variant:"bordered",radius:"md",label:"วันที่เข้ารับบริการ",size:"md",placeholder:"Date admitted",value:Y?(0,n.default)(Y?.regdate).add(543,"years").format("DD/MM/YYYY"):"",labelPlacement:"outside-top",isDisabled:!0}),(0,d.jsx)(i.Input,{variant:"bordered",radius:"md",label:"วันที่สิ้นสุด",size:"md",placeholder:"Date discharged",value:Y?(0,n.default)(Y?.dchdate).add(543,"years").format("DD/MM/YYYY"):"",labelPlacement:"outside-top",isDisabled:!0}),(0,d.jsxs)("div",{className:"flex flex-col items-center w-full h-full",children:[(0,d.jsx)("div",{className:"flex items-center justify-between w-full",children:(0,d.jsx)("p",{className:"text-sm mb-2",children:"ตัวเลือก"})}),(0,d.jsx)("div",{className:"w-full items-center",children:(0,d.jsx)(o.motion.button,{onClick:()=>_(!0),disabled:!ac,className:"w-full text-sm text-center text-rose-700 border-rose-700 !disabled:dark:hover:border-rose-800 border font-semibold px-6 py-2 hover:bg-red-50 !disabled:dark:hover:bg-rose-800 rounded-xl dark:bg-rose-700 dark:text-white cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed",children:"ลบข้อมูล"})})]})]})]})]}),!ac&&(0,d.jsx)("div",{className:"shadow-lg rounded-2xl",children:(0,d.jsx)(j.default,{columnDefs:aq,rowData:I,loading:S,pagination:!1,onCellValueChanged:a=>{a.api.refreshCells({rowNodes:[a.node],force:!0});let b=[];a.api.forEachNode(a=>{b.push({...a.data})}),X(a=>({...a,content:b.map(a=>{let{created_at:b,updated_at:c,created_by:d,updated_by:e,total_score:f,content_of_medical_records:g,...h}=a,i={content_of_medical_record_id:g?.content_of_medical_record_id};for(let a in h){let b=h[a];"comment"===a?i[a]=b??null:"na"===a||"missing"===a||"no"===a?i[a]=!!b:i[a]="boolean"==typeof b?+!!b:null==b?0:b}return i})}))},onGridReady:aj})}),I.length>0&&!ac&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("hr",{className:"mt-8 mb-6"}),(0,d.jsx)("p",{className:"underline underline-offset-2 select-none",children:"ประเมินคุณภาพการบันทึกเวชระเบียนในภาพรวม"}),(0,d.jsxs)("div",{className:"flex items-start gap-2 py-2",children:[(0,d.jsx)("p",{className:"font-semibold w-[130px] text-sm",children:"Overall Finding"}),(0,d.jsx)("div",{className:"flex flex-col gap-2",children:K.length>0&&K.map((a,b)=>(0,d.jsx)(p.Checkbox,{size:"sm",value:a.overall_finding_result,defaultSelected:!!K&&a.overall_finding_result,onValueChange:b=>((a,b)=>{let c=b?.overall_finding?.overall_finding_id??b?.overall_finding_id,d=b?.form_ipd_overall_finding_result_id??null;if(!c)return;let e=b?.overall_finding_result===!0;X(b=>{let f=[...b.overall],g=f.findIndex(a=>a.overall_finding_id===c);return g>-1?a===e?f.splice(g,1):f[g]={...f[g],overall_finding_result:a,form_ipd_overall_finding_result_id:f[g].form_ipd_overall_finding_result_id??d}:a!==e&&f.push({form_ipd_overall_finding_result_id:d,overall_finding_id:c,overall_finding_result:a}),{...b,overall:f}})})(b,a),label:"ไม่ต้องการบันทึก",radius:"full",children:a.overall_finding.overall_finding_name},b))})]}),(0,d.jsxs)("div",{className:"flex items-start gap-2 py-2 select-none",children:[(0,d.jsx)("p",{className:"font-semibold w-[130px] text-sm",children:"(เลือกเพียง 1 ข้อ)"}),(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsx)(r.RadioGroup,{onValueChange:a=>(a=>{let b=M?.find(b=>b.review_status_id===a);X(a=>({...a,review_status_id:b.review_status_id,review_status_result:!0,review_status_comment:b.review_status_comment}))})(a),children:M?.length>0&&M?.map(a=>(0,d.jsxs)(q.Radio,{size:"sm",value:a.review_status_id,children:[a.review_status_name," (",a.review_status_description,")"]},a.review_status_id))}),M&&M?.find(a=>a.review_status_id===W.review_status_id)?.review_status_type===!0&&(0,d.jsx)(i.Input,{onValueChange:a=>X(b=>({...b,review_status_comment:a})),variant:"bordered",labelPlacement:"outside",radius:"md",label:"อื่นๆ",placeholder:"อื่นๆ",value:W.review_status_comment})]})]})]}),ac&&(""===O?(0,d.jsx)(o.motion.div,{initial:{opacity:0},animate:{opacity:1},className:"z-50 fixed inset-0 w-full h-dvh flex items-center justify-center backdrop-blur-xs",children:(0,d.jsx)(f.default,{title:"กําลังสร้าง PDF..."})}):(0,d.jsx)("div",{className:"w-full h-[calc(100vh-15vh)] overflow-hidden rounded-2xl my-2 shadow-lg",children:(0,d.jsx)("iframe",{title:"pdf",loading:"lazy",width:"100%",height:"100%",src:`data:application/pdf;base64,${O}`,className:"w-full h-full"})})),!ac&&(0,d.jsx)(o.motion.button,{onClick:ar,className:"w-full mt-4 text-emerald-700 font-semibold py-2 bg-emerald-50 border border-emerald-700 dark:hover:bg-emerald-800 rounded-2xl dark:bg-emerald-700 dark:text-white cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed",onMouseDown:a=>ai.create(a),disabled:aa||0===I.length||U||null==Y,children:aa?"กำลังบันทึกข้อมูล":"บันทึก"})]})}[s,t]=z.then?(await z)():z,c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=src_app_%28public%29_forms_ipd_page_jsx_b050ba48._.js.map